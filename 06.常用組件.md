# 常用組件介紹

> 介紹幾個在Opas前端常用的組件

---

由於在main.ts中，已經透過全局式註冊的方式引入Quasar的組件，因此能在這個專案底下的template內直接使用Quasar的組件，如下：

```vue
<template>
  <q-btn label="Button" />
  
  <q-card>
    <q-card-section>
      Card Content
    </q-card-section>
  </q-card>

  <q-icon name="font_download" />
</template>
```

本專案的UI是基於Quasar Framework進行套用，因此每個組件的使用方法，請參考Quasar的官方文件：[https://quasar.dev/](https://quasar.dev/)

如果不是全局式註冊的方式引入的組件，則需要在使用的時候，再該vue檔案中引入相應的組件，如下：
```vue
<template>
  <Table :rows="rows" :columns="columns" />
</template>
<script lang="ts" setup>
import Table from "src/components/OPTable.vue"  // 以q-table進行客製化的組件
</script>
```

---

以下介紹在Opas裡最常用的幾個組件:

## 1. q-select

> 用於顯示下拉選單，詳細用法請參考：[https://quasar.dev/vue-components/select](https://quasar.dev/vue-components/select)

**1-1. 單選**
```vue
<template>
  <q-select v-model="selectedValue" :options="options" />
</template>
<script lang="ts" setup>
import { ref } from "vue"

const selectedValue = ref("Option 1")
const options = ["Option 1", "Option 2", "Option 3"]

</script>
```

**1-2. 多選**

```vue
<template>
  <q-select v-model="selectedValue" :options="options" multiple />
</template>
<script lang="ts" setup>
import { ref } from "vue"

const selectedValue = ref(["Option 1", "Option 2"])
const options = ["Option 1", "Option 2", "Option 3"]
</script>
```

**1-3. 選項可變**

```vue
<template>
  <q-select v-model="selected1Value" :options="options1" />
  <q-select v-model="selected2Value" :options="options2" />
</template>
<script lang="ts" setup>
import { ref, computed } from "vue"

const selected1Value = ref("Option 1")
const selected2Value = ref("Option 1")
const options1 = ["Option 1", "Option 2", "Option 3"]
const options2 = computed(() => {
  if (selected1Value.value === "Option 1") {
    return ["Option 1", "Option 2", "Option 3"]
  } else {
    return ["Option 4", "Option 5", "Option 6"]
  }
})
</script>
```

**1-4. 數值重置**

```vue
<template>
  <Select :model-value="selectedValue1" @update:model-value="" :options="options" />
  <Select v-model="selectedValue2" :options="options" />
</template>
<script lang="ts" setup>
import Select from 'src/components/QSingleSelect.vue'
import { ref } from "vue"

const selectedValue = ref(1)
const options = [
  { label: "Option 1", value: 1 },
  { label: "Option 2", value: 2 },
  { label: "Option 3", value: 3 },
]

const handleUpdateSelectedValue = (value: number|string|null) => {
  selectedValue.value = value
  selectedValue2.value = 1
}
</script>
```

**1-5. 階層式選單**

```vue
<template>
<q-select label='BU' v-model="bu" :options="buOptions" />
<q-select label='Customer' v-model="customer" :options="customerOptions" />
</template>
<script lang="ts" setup>

const customerText = ref("")
const bu = ref("FT"),
  customer = ref("")

const buOptions = ["FT", "CP", "DS", "RFID"]
const customerOptions = computed(() => {
  let options = [{ value: "", label: "All" }]
  if (customerText.value == "") return options
  customerText.value.split(";").forEach(row => {
    bu.value.forEach(b => {
      if (row.includes(`,${b}-`)) {
        const [value, label] = row.split(`,${b}-`);
        options.push({ value, label })
      }
    })
  })
  return options
})
</script>
```


> 詳細用法請參考：[https://quasar.dev/vue-components/select](https://quasar.dev/vue-components/select)

## 2. q-table

**2-1. 基本用法**

```vue
<template>
  <q-table :rows="rows" :columns="columns" />
</template>
<script lang="ts" setup>
const columns = [
  {
    name: 'name',
    required: true,
    label: 'Dessert (100g serving)',
    align: 'left',
    field: row => row.name,
    format: val => `${val}`,
    sortable: true
  },
  { name: 'calories', align: 'center', label: 'Calories', field: 'calories', sortable: true },
  { name: 'fat', label: 'Fat (g)', field: 'fat', sortable: true },
  { name: 'carbs', label: 'Carbs (g)', field: 'carbs' },
  { name: 'protein', label: 'Protein (g)', field: 'protein' },
  { name: 'sodium', label: 'Sodium (mg)', field: 'sodium' },
  { name: 'calcium', label: 'Calcium (%)', field: 'calcium', sortable: true, sort: (a, b) => parseInt(a, 10) - parseInt(b, 10) },
  { name: 'iron', label: 'Iron (%)', field: 'iron', sortable: true, sort: (a, b) => parseInt(a, 10) - parseInt(b, 10) }
]

const rows = [
  {
    name: 'Frozen Yogurt',
    calories: 159,
    fat: 6.0,
    carbs: 24,
    protein: 4.0,
    sodium: 87,
    calcium: '14%',
    iron: '1%'
  },
  {
    name: 'Ice cream sandwich',
    calories: 237,
    fat: 9.0,
    carbs: 37,
    protein: 4.3,
    sodium: 129,
    calcium: '8%',
    iron: '1%'
  },
  {
    name: 'Eclair',
    calories: 262,
    fat: 16.0,
    carbs: 23,
    protein: 6.0,
    sodium: 337,
    calcium: '6%',
    iron: '7%'
  },
  {
    name: 'Cupcake',
    calories: 305,
    fat: 3.7,
    carbs: 67,
    protein: 4.3,
    sodium: 413,
    calcium: '3%',
    iron: '8%'
  },
  {
    name: 'Gingerbread',
    calories: 356,
    fat: 16.0,
    carbs: 49,
    protein: 3.9,
    sodium: 327,
    calcium: '7%',
    iron: '16%'
  },
  {
    name: 'Jelly bean',
    calories: 375,
    fat: 0.0,
    carbs: 94,
    protein: 0.0,
    sodium: 50,
    calcium: '0%',
    iron: '0%'
  },
  {
    name: 'Lollipop',
    calories: 392,
    fat: 0.2,
    carbs: 98,
    protein: 0,
    sodium: 38,
    calcium: '0%',
    iron: '2%'
  },
  {
    name: 'Honeycomb',
    calories: 408,
    fat: 3.2,
    carbs: 87,
    protein: 6.5,
    sodium: 562,
    calcium: '0%',
    iron: '45%'
  },
  {
    name: 'Donut',
    calories: 452,
    fat: 25.0,
    carbs: 51,
    protein: 4.9,
    sodium: 326,
    calcium: '2%',
    iron: '22%'
  },
  {
    name: 'KitKat',
    calories: 518,
    fat: 26.0,
    carbs: 65,
    protein: 7,
    sodium: 54,
    calcium: '12%',
    iron: '6%'
  }
]
</script>
```

**2-2. 合併儲存格**

可參考人力分析HumanAnalysis/ATE/ATEIndex.vue

```vue
<template>
  <q-table :rows="rows" :columns="columns" >
    <template #body-cell-Type="props">
      <q-td
        :props
        class="type"
        v-show="firstRowspan[props.rowIndex]"
        :rowspan="firstRowspan[props.rowIndex]"
        >{{ props.value }}</q-td
      >
    </template>
  </q-table>
</template>
<style scoped>
:deep(td.summary),
:deep(td.summary ~ td) {
  background-color: rgb(226, 239, 218) !important;
}
:deep(td.manpower-actual),
:deep(td.manpower-actual ~ td) {
  background-color: rgb(221, 235, 247) !important;
}
:deep(td.manpower-loading),
:deep(td.manpower-loading ~ td) {
  background-color: rgb(252, 228, 214) !important;
}
:deep(td.bg-softCream),
:deep(td.bg-softCream ~ td) {
  background-color: rgb(255, 242, 204) !important;
}
</style>
<script lang="ts" setup>

const classes = (row: any) => {
  let arr = ["Total_作業時間", "Total_每班需求人力", "需求人機比", "Total_需求人力"];
  if (row.Type == "Summary" && lastQuery.value[2] == "All") {
    if (row.item == "Total_實際人力") return "manpower-actual";
    else if (row.item == "Total_人力負荷") return "manpower-loading";
    return "summary";
  }
  if (arr.includes(row.item)) {
    return "bg-softCream";
  }
  return "";
};

const classesMonth = (month: string) => (row: any) => {
  if (row.item == "Total_人力負荷") {
    if (numbro(row[month]).value() >= 1) return "text-red-600";
  }

  if (row.item == "Total_需求人力" && typeof numbro(row[month]).value() === "number") {
    return "underline text-bold cursor-pointer";
  }
  return "";
};

const formatter = (val: any) => {
  if (val.includes("，")) return val.replaceAll("，", ",");
  return val;
};

const columnDefs: QTableProps["columns"] = [
  {
    name: "Type",
    label: "Type",
    align: "center",
    field: "Type",
  },
  {
    name: "item",
    label: "Item",
    align: "left",
    field: "item",
    classes,
    headerClasses: "text-center",
  },
];

const month = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];
month.forEach((name) => {
  columnDefs.push({
    name,
    label: name,
    align: "center",
    field: name,
    classes: classesMonth(name),
    format: formatter,
  });
});

const rows = ref<Record<string, unknown>[]>([])


const firstRowspan = computed(() => {
  let arr = [0];
  let type: [string, number] = ["", 0];
  rows.value.forEach((row, i) => {
    if (i == 0) type[0] = row.Type as string;
    else {
      arr.push(0);
      if (type[0] !== row.Type) {
        let index = arr.length - (type[1] + 1);
        arr[index] = type[1];
        type[0] = row.Type as string;
        type[1] = 0;
      }
      if (i == rows.value.length - 1) {
        let index = arr.length - (type[1] + 1);
        arr[index] = type[1] + 1;
      }
    }
    type[1]++;
  });
  return arr;
});

</script>
```

**2-3. 切換編輯與檢視模式**

```vue
<template>
  <q-btn label="Edit" @click="isEdit = !isEdit" />
  <q-table :rows="rows" :columns="columns" >
    <template #body-cell-name="props">
      <q-td :props="props">
        <q-input v-show="isEdit" v-model="props.row.name" />
        <span v-show="!isEdit">
          {{ props.row.name }}
        </span>
      </q-td>
    </template>
    <template #body-cell-fat="props">
      <q-td :props>
        <q-input v-show="isEdit" v-model="props.row.name" />
        <span v-show="!isEdit">
          {{ props.value }}
        </span>
      </q-td>
    </template>
  </q-table>
</template>
<script lang="ts" setup>
import { ref } from "vue"
const isEdit = ref(false)

const columns = ref([
  {
    name: 'name',
    required: true,
    label: 'Dessert (100g serving)',
    align: 'left',
    field: row => row.name,
  },
  { name: 'calories', align: 'center', label: 'Calories', field: 'calories', sortable: true },
  { name: 'fat', label: 'Fat (g)', field: 'fat', sortable: true },
  { name: 'carbs', label: 'Carbs (g)', field: 'carbs' },
  { name: 'protein', label: 'Protein (g)', field: 'protein' },
  { name: 'sodium', label: 'Sodium (mg)', field: 'sodium' },
  { name: 'calcium', label: 'Calcium (%)', field: 'calcium', sortable: true, sort: (a, b) => parseInt(a, 10) - parseInt(b, 10) },
  { name: 'iron', label: 'Iron (%)', field: 'iron', sortable: true, sort: (a, b) => parseInt(a, 10) - parseInt(b, 10) }
])

const rows = ref<Record<string, string | number>[]>([
  {
    name: 'Frozen Yogurt',
    calories: 159,
    fat: 6.0,
    carbs: 24,
    protein: 4.0,
    sodium: 87,
    calcium: '14%',
    iron: '1%'
  },
  {
    name: 'Ice cream sandwich',
    calories: 237,
    fat: 9.0,
    carbs: 37,
    protein: 4.3,
    sodium: 129,
    calcium: '8%',
    iron: '1%'
  },
  {
    name: 'Eclair',
    calories: 262,
    fat: 16.0,
    carbs: 23,
    protein: 6.0,
    sodium: 337,
    calcium: '6%',
    iron: '7%'
  },
  {
    name: 'Cupcake',
    calories: 305,
    fat: 3.7,
    carbs: 67,
    protein: 4.3,
    sodium: 413,
    calcium: '3%',
    iron: '8%'
  },
  {
    name: 'Gingerbread',
    calories: 356,
    fat: 16.0,
    carbs: 49,
    protein: 3.9,
    sodium: 327,
    calcium: '7%',
    iron: '16%'
  },
  {
    name: 'Jelly bean',
    calories: 375,
    fat: 0.0,
    carbs: 94,
    protein: 0.0,
    sodium: 50,
    calcium: '0%',
    iron: '0%'
  },
  {
    name: 'Lollipop',
    calories: 392,
    fat: 0.2,
    carbs: 98,
    protein: 0,
    sodium: 38,
    calcium: '0%',
    iron: '2%'
  },
  {
    name: 'Honeycomb',
    calories: 408,
    fat: 3.2,
    carbs: 87,
    protein: 6.5,
    sodium: 562,
    calcium: '0%',
    iron: '45%'
  },
  {
    name: 'Donut',
    calories: 452,
    fat: 25.0,
    carbs: 51,
    protein: 4.9,
    sodium: 326,
    calcium: '2%',
    iron: '22%'
  },
  {
    name: 'KitKat',
    calories: 518,
    fat: 26.0,
    carbs: 65,
    protein: 7,
    sodium: 54,
    calcium: '12%',
    iron: '6%'
  }
])
</script>
```

**2-4. Pagination控制**

```vue
<template>
  <Table :rows="rows" :columns="columns" v-model:pagination="pagination" />
</template>
<script lang="ts" setup>
import Table from 'src/components/OPTable.vue'
const pagination = ref({
  page: 1,
  rowsPerPage: 10,
  sortBy: "name",
  descending: false,
})

const columns = ref([
  {
    name: 'name',
    required: true,
    label: 'Dessert (100g serving)',
    align: 'left',
    field: row => row.name,
  },
  { name: 'calories', align: 'center', label: 'Calories', field: 'calories', sortable: true },
  { name: 'fat', label: 'Fat (g)', field: 'fat', sortable: true },
  { name: 'carbs', label: 'Carbs (g)', field: 'carbs' },
  { name: 'protein', label: 'Protein (g)', field: 'protein' },
  { name: 'sodium', label: 'Sodium (mg)', field: 'sodium' },
  { name: 'calcium', label: 'Calcium (%)', field: 'calcium', sortable: true, sort: (a, b) => parseInt(a, 10) - parseInt(b, 10) },
  { name: 'iron', label: 'Iron (%)', field: 'iron', sortable: true, sort: (a, b) => parseInt(a, 10) - parseInt(b, 10) }
])

const rows = ref<Record<string, string | number>[]>([
  {
    name: 'Frozen Yogurt',
    calories: 159,
    fat: 6.0,
    carbs: 24,
    protein: 4.0,
    sodium: 87,
    calcium: '14%',
    iron: '1%'
  },
  {
    name: 'Ice cream sandwich',
    calories: 237,
    fat: 9.0,
    carbs: 37,
    protein: 4.3,
    sodium: 129,
    calcium: '8%',
    iron: '1%'
  },
  {
    name: 'Eclair',
    calories: 262,
    fat: 16.0,
    carbs: 23,
    protein: 6.0,
    sodium: 337,
    calcium: '6%',
    iron: '7%'
  },
  {
    name: 'Cupcake',
    calories: 305,
    fat: 3.7,
    carbs: 67,
    protein: 4.3,
    sodium: 413,
    calcium: '3%',
    iron: '8%'
  },
  {
    name: 'Gingerbread',
    calories: 356,
    fat: 16.0,
    carbs: 49,
    protein: 3.9,
    sodium: 327,
    calcium: '7%',
    iron: '16%'
  },
  {
    name: 'Jelly bean',
    calories: 375,
    fat: 0.0,
    carbs: 94,
    protein: 0.0,
    sodium: 50,
    calcium: '0%',
    iron: '0%'
  },
  {
    name: 'Lollipop',
    calories: 392,
    fat: 0.2,
    carbs: 98,
    protein: 0,
    sodium: 38,
    calcium: '0%',
    iron: '2%'
  },
  {
    name: 'Honeycomb',
    calories: 408,
    fat: 3.2,
    carbs: 87,
    protein: 6.5,
    sodium: 562,
    calcium: '0%',
    iron: '45%'
  },
  {
    name: 'Donut',
    calories: 452,
    fat: 25.0,
    carbs: 51,
    protein: 4.9,
    sodium: 326,
    calcium: '2%',
    iron: '22%'
  },
  {
    name: 'KitKat',
    calories: 518,
    fat: 26.0,
    carbs: 65,
    protein: 7,
    sodium: 54,
    calcium: '12%',
    iron: '6%'
  }
])

</script>
```

> 詳細用法請參考：[https://quasar.dev/vue-components/table](https://quasar.dev/vue-components/table)

## 3. q-date

> 用於顯示日期選擇器，詳細用法請參考：[https://quasar.dev/vue-components/date](https://quasar.dev/vue-components/date)

```vue
<template>
  <q-date v-model="date" />
</template>
<script lang="ts" setup>
import { ref } from "vue";

const date = ref("2019/02/01");
const allowWednesday = (date: string) => new Date(date).getDay() == 3;
</script>
```